<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin - TEMUR STYLE</title>
  <style>
    :root{--bg:#000;--text:#fff;--muted:#9aa0a6;--yellow:#ffcc00;--blue:#198cff}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,Arial;padding:18px}
    input,textarea,select,button{font-size:14px;padding:8px;border-radius:8px;border:1px solid #222;background:#070707;color:var(--text)}
    .btn-yellow{background:var(--yellow);color:#000;border:none}
    .btn-blue{background:var(--blue);color:#fff;border:none}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .card{border:1px solid #111;padding:12px;border-radius:10px;margin-top:12px;background:#070707}
    img{max-width:120px;border-radius:6px}
    label{display:block;margin-bottom:6px;color:var(--muted)}
  </style>
</head>
<body>
  <h2>Admin Panel — TEMUR STYLE</h2>

  <div id="loginBox" class="card">
    <label>Parol kiriting (hozirgi: <b>temur123</b>)</label>
    <input id="pass" type="password" placeholder="Parol">
    <div style="margin-top:8px">
      <button class="btn-yellow" onclick="login()">Kirish</button>
    </div>
  </div>

  <div id="panel" style="display:none">
    <div class="card">
      <h3>Yangi mahsulot qo'shish</h3>
      <label>Nom (UZ)</label><input id="name_uz" placeholder="Masalan: Futbolka Oq">
      <label>Nom (RU)</label><input id="name_ru" placeholder="Например: Футболка белая">
      <label>Narx (butun son, so'm)</label><input id="price" placeholder="80000">
      <label>Rasm URL</label><input id="img" placeholder="https://...jpg">
      <label>Short izoh (UZ)</label><input id="desc_uz" placeholder="Qisqacha...">
      <label>Short izoh (RU)</label><input id="desc_ru" placeholder="Коротко...">
      <div style="margin-top:8px" class="row">
        <button class="btn-yellow" onclick="addProduct()">Qo'shish</button>
        <button class="btn" onclick="clearForm()">Tozalash</button>
        <button class="btn-blue" onclick="exportProducts()">Export products (JSON)</button>
      </div>
    </div>

    <div class="card">
      <h3>Mahsulotlar</h3>
      <div id="plist"></div>
    </div>

    <div class="card">
      <h3>Buyurtmalar</h3>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <button class="btn-blue" onclick="renderOrders()">Yangilash</button>
        <button class="btn" onclick="downloadOrders()">Yuklab olish (orders.json)</button>
        <button class="btn" onclick="clearOrders()">O'chirish (local)</button>
      </div>
      <div id="ordersList"></div>
    </div>
  </div>

<script>
/* ADMIN: simple password + localStorage-based data
   Change ADMIN_PASSWORD variable in code to update password.
*/
const ADMIN_PASSWORD = 'temur123';
const PRODUCTS_KEY = 'temur_products';
const ORDERS_KEY = 'temur_orders';

function $(s){return document.querySelector(s)}
function loadProducts(){ try{return JSON.parse(localStorage.getItem(PRODUCTS_KEY)||'[]')}catch(e){return[]} }
function saveProducts(p){ localStorage.setItem(PRODUCTS_KEY, JSON.stringify(p)) }
function loadOrders(){ try{return JSON.parse(localStorage.getItem(ORDERS_KEY)||'[]')}catch(e){return[]} }
function saveOrders(o){ localStorage.setItem(ORDERS_KEY, JSON.stringify(o)) }

/* LOGIN */
function login(){
  const v = $('#pass').value;
  if(v === ADMIN_PASSWORD){
    $('#loginBox').style.display='none';
    $('#panel').style.display='block';
    renderProductsAdmin();
    renderOrders();
  } else alert('Noto\'g\'ri parol!');
}

/* PRODUCTS CRUD */
function addProduct(){
  const name_uz = $('#name_uz').value.trim();
  const name_ru = $('#name_ru').value.trim();
  const price = parseInt($('#price').value) || 0;
  const img = $('#img').value.trim() || '';
  const desc_uz = $('#desc_uz').value.trim() || '';
  const desc_ru = $('#desc_ru').value.trim() || '';
  if(!name_uz || !name_ru || !price){ alert('Iltimos nom va narx kiriting'); return; }
  const list = loadProducts();
  const id = 'p' + Date.now();
  list.push({id, name_uz, name_ru, price, img, desc_uz, desc_ru});
  saveProducts(list);
  renderProductsAdmin();
  clearForm();
  alert('Mahsulot qoʻshildi');
}

function clearForm(){
  $('#name_uz').value=''; $('#name_ru').value=''; $('#price').value=''; $('#img').value=''; $('#desc_uz').value=''; $('#desc_ru').value='';
}

function renderProductsAdmin(){
  const list = loadProducts();
  const box = $('#plist'); box.innerHTML='';
  if(!list.length){ box.innerHTML='<i>Mahsulotlar yoʻq</i>'; return; }
  list.forEach(p=>{
    const div = document.createElement('div'); div.style.display='flex'; div.style.gap='12px'; div.style.alignItems='center'; div.style.marginBottom='10px';
    div.innerHTML = `
      <div style="flex:1">
        <b>${p.name_uz}</b> — <span class="small">${p.price} so'm</span><br>
        <span class="small">${p.name_ru}</span><br>
        <img src="${p.img}" onerror="this.style.display='none'">
      </div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <button class="btn-blue" onclick='editProduct("${p.id}")'>Tahrirlash</button>
        <button class="btn" onclick='deleteProduct("${p.id}")'>O'chirish</button>
      </div>
    `;
    box.appendChild(div);
  });
}

function deleteProduct(id){
  if(!confirm('O\'chirilsinmi?')) return;
  const list = loadProducts().filter(p=>p.id !== id);
  saveProducts(list);
  renderProductsAdmin();
}

/* simple edit — prefill form, delete old on save */
function editProduct(id){
  const list = loadProducts();
  const p = list.find(x=>x.id===id);
  if(!p) return;
  $('#name_uz').value = p.name_uz;
  $('#name_ru').value = p.name_ru;
  $('#price').value = p.price;
  $('#img').value = p.img;
  $('#desc_uz').value = p.desc_uz;
  $('#desc_ru').value = p.desc_ru;
  // remove old entry; on Add it will create new id
  const filtered = list.filter(x=>x.id!==id);
  saveProducts(filtered);
  renderProductsAdmin();
}

/* ORDERS */
function renderOrders(){
  const list = loadOrders();
  const box = $('#ordersList'); box.innerHTML='';
  if(!list.length){ box.innerHTML='<i>Buyurtma topilmadi</i>'; return; }
  list.slice().reverse().forEach(o=>{
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `<b>ID:</b> ${o.id} <br><b>Vaqt:</b> ${o.created} <br><b>Ism:</b> ${o.name} <br><b>Telefon:</b> ${o.phone} <br><b>Manzil:</b> ${o.addr} <br>
      <details style="margin-top:8px"><summary>Buyurtma tafsiloti</summary><pre style="white-space:pre-wrap">${JSON.stringify(o.items, null, 2)}</pre></details>
    `;
    box.appendChild(div);
  });
}

function downloadOrders(){
  const orders = loadOrders();
  if(!orders.length){ alert('Buyurtma yo\'q'); return; }
  const blob = new Blob([JSON.stringify(orders, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'orders.json'; a.click();
  URL.revokeObjectURL(url);
}

function clearOrders(){
  if(confirm('Haqiqatan ham barcha buyurtmalarni o`chirishni xohlaysizmi?')){ localStorage.removeItem(ORDERS_KEY); renderOrders(); alert('O`chirildi'); }
}

function exportProducts(){
  const p = loadProducts();
  if(!p.length){ alert('Mahsulot yo\'q'); return; }
  const blob = new Blob([JSON.stringify(p, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'products.json'; a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>